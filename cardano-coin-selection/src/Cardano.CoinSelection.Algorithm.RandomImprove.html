<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright: &#169; 2018-2024 Intersect MBO</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- This module contains an implementation of the __Random-Improve__ coin</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- selection algorithm.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.CoinSelection.Algorithm.RandomImprove</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#randomImprove"><span class="hs-identifier">randomImprove</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html"><span class="hs-identifier">Cardano.CoinSelection</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier">CoinMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier">CoinMapEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelection"><span class="hs-identifier">CoinSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionAlgorithm"><span class="hs-identifier">CoinSelectionAlgorithm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionError"><span class="hs-identifier">CoinSelectionError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionLimit"><span class="hs-identifier">CoinSelectionLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionParameters"><span class="hs-identifier">CoinSelectionParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionResult"><span class="hs-identifier">CoinSelectionResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#InputCountInsufficientError"><span class="hs-identifier">InputCountInsufficientError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#InputLimitExceededError"><span class="hs-identifier">InputLimitExceededError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#InputValueInsufficientError"><span class="hs-identifier">InputValueInsufficientError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#InputsExhaustedError"><span class="hs-identifier">InputsExhaustedError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#coinMapFromList"><span class="hs-identifier">coinMapFromList</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#coinMapRandomEntry"><span class="hs-identifier">coinMapRandomEntry</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#coinMapToList"><span class="hs-identifier">coinMapToList</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#coinMapValue"><span class="hs-identifier">coinMapValue</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#foldM"><span class="hs-identifier">foldM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Except</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwE</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runMaybeT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Random.Types</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadRandom</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Ord.html#Down"><span class="hs-identifier">Down</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Internal.Coin.html"><span class="hs-identifier">Internal.Coin</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Internal.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Internal.Coin.html"><span class="hs-identifier">Internal.Coin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- | An implementation of the __Random-Improve__ coin selection algorithm.</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- = Overview</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- The __Random-Improve__ coin selection algorithm works in __two phases__, by</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- /first/ selecting UTxO entries /at random/ to pay for each of the given</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- outputs, and /then/ attempting to /improve/ upon each of the selections.</span><span>
</span><span id="line-54"></span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- === Phase 1: Random Selection</span><span>
</span><span id="line-56"></span><span class="hs-comment">--</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- __In this phase, the algorithm randomly selects a minimal set of UTxO__</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- __entries to pay for each of the given outputs.__</span><span>
</span><span id="line-59"></span><span class="hs-comment">--</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- During this phase, the algorithm:</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">--   *  processes outputs in /descending order of coin value/.</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">--   *  maintains a /remaining UTxO set/, initially equal to the given</span><span>
</span><span id="line-65"></span><span class="hs-comment">--      /UTxO set/ parameter.</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- For each output of value __/v/__, the algorithm /randomly/ selects entries</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- from the /remaining UTxO set/, until the total value of selected entries is</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- greater than or equal to __/v/__. The selected entries are then associated</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- with that output, and removed from the /remaining UTxO set/.</span><span>
</span><span id="line-71"></span><span class="hs-comment">--</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- This phase ends when every output has been associated with a selection of</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- UTxO entries.</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- However, if the remaining UTxO set is completely exhausted before all</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- outputs can be processed, the algorithm terminates with an error.</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- === Phase 2: Improvement</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- __In this phase, the algorithm attempts to improve upon each of the UTxO__</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- __selections made in the previous phase, by conservatively expanding the__</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- __selection made for each output.__</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- During this phase, the algorithm:</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">--   *  processes outputs in /ascending order of coin value/.</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">--   *  continues to maintain the /remaining UTxO set/ produced by the previous</span><span>
</span><span id="line-89"></span><span class="hs-comment">--      phase.</span><span>
</span><span id="line-90"></span><span class="hs-comment">--</span><span>
</span><span id="line-91"></span><span class="hs-comment">--   *  maintains an /accumulated coin selection/, which is initially /empty/.</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- For each output of value __/v/__, the algorithm:</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">--  1.  __Calculates a /target range/__ for the total value of inputs used to</span><span>
</span><span id="line-96"></span><span class="hs-comment">--      pay for that output, defined by the triplet:</span><span>
</span><span id="line-97"></span><span class="hs-comment">--</span><span>
</span><span id="line-98"></span><span class="hs-comment">--      (/minimum/, /ideal/, /maximum/) = (/v/, /2v/, /3v/)</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">--  2.  __Attempts to /improve/ upon the /existing UTxO selection/__ for that</span><span>
</span><span id="line-101"></span><span class="hs-comment">--      output, by repeatedly selecting additional entries at random from the</span><span>
</span><span id="line-102"></span><span class="hs-comment">--      /remaining UTxO set/, stopping when the selection can be improved upon</span><span>
</span><span id="line-103"></span><span class="hs-comment">--      no further.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span class="hs-comment">--      A selection with value /v1/ is considered to be an /improvement/ over a</span><span>
</span><span id="line-106"></span><span class="hs-comment">--      selection with value /v0/ if __all__ of the following conditions are</span><span>
</span><span id="line-107"></span><span class="hs-comment">--      satisfied:</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">--       * __Condition 1__: we have moved closer to the /ideal/ value:</span><span>
</span><span id="line-110"></span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span class="hs-comment">--             abs (/ideal/ &#8722; /v1/) &lt; abs (/ideal/ &#8722; /v0/)</span><span>
</span><span id="line-112"></span><span class="hs-comment">--</span><span>
</span><span id="line-113"></span><span class="hs-comment">--       * __Condition 2__: we have not exceeded the /maximum/ value:</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">--             /v1/ &#8804; /maximum/</span><span>
</span><span id="line-116"></span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span class="hs-comment">--       * __Condition 3__: when counting cumulatively across all outputs</span><span>
</span><span id="line-118"></span><span class="hs-comment">--       considered so far, we have not selected more than the /maximum/ number</span><span>
</span><span id="line-119"></span><span class="hs-comment">--       of UTxO entries specified by 'limit'.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">--  3.  __Creates a /change value/__ for the output, equal to the total value</span><span>
</span><span id="line-122"></span><span class="hs-comment">--      of the /final UTxO selection/ for that output minus the value /v/ of</span><span>
</span><span id="line-123"></span><span class="hs-comment">--      that output.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">--  4.  __Updates the /accumulated coin selection/__:</span><span>
</span><span id="line-126"></span><span class="hs-comment">--</span><span>
</span><span id="line-127"></span><span class="hs-comment">--       * Adds the /output/ to 'outputs'.</span><span>
</span><span id="line-128"></span><span class="hs-comment">--       * Adds the /improved UTxO selection/ to 'inputs'.</span><span>
</span><span id="line-129"></span><span class="hs-comment">--       * Adds the /change value/ to 'change'.</span><span>
</span><span id="line-130"></span><span class="hs-comment">--</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- This phase ends when every output has been processed, __or__ when the</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- /remaining UTxO set/ has been exhausted, whichever occurs sooner.</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- = Termination</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- When both phases are complete, the algorithm terminates.</span><span>
</span><span id="line-137"></span><span class="hs-comment">--</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- The /accumulated coin selection/ and /remaining UTxO set/ are returned to</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- the caller.</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- === Failure Modes</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- The algorithm terminates with an __error__ if:</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">--  1.  The /total value/ of the initial UTxO set (the amount of money</span><span>
</span><span id="line-146"></span><span class="hs-comment">--      /available/) is /less than/ the total value of the output list (the</span><span>
</span><span id="line-147"></span><span class="hs-comment">--      amount of money /required/).</span><span>
</span><span id="line-148"></span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span class="hs-comment">--      See: __'InputValueInsufficientError'__.</span><span>
</span><span id="line-150"></span><span class="hs-comment">--</span><span>
</span><span id="line-151"></span><span class="hs-comment">--  2.  The /number/ of entries in the initial UTxO set is /smaller than/ the</span><span>
</span><span id="line-152"></span><span class="hs-comment">--      number of requested outputs.</span><span>
</span><span id="line-153"></span><span class="hs-comment">--</span><span>
</span><span id="line-154"></span><span class="hs-comment">--      Due to the nature of the algorithm, /at least one/ UTxO entry is</span><span>
</span><span id="line-155"></span><span class="hs-comment">--      required /for each/ output.</span><span>
</span><span id="line-156"></span><span class="hs-comment">--</span><span>
</span><span id="line-157"></span><span class="hs-comment">--      See: __'InputCountInsufficientError'__.</span><span>
</span><span id="line-158"></span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span class="hs-comment">--  3.  Due to the particular /distribution/ of values within the initial UTxO</span><span>
</span><span id="line-160"></span><span class="hs-comment">--      set, the algorithm depletes all entries from the UTxO set /before/ it</span><span>
</span><span id="line-161"></span><span class="hs-comment">--      is able to pay for all requested outputs.</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">--      See: __'InputsExhaustedError'__.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">--  4.  The /number/ of UTxO entries needed to pay for the requested outputs</span><span>
</span><span id="line-166"></span><span class="hs-comment">--      would /exceed/ the upper limit specified by 'limit'.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">--      See: __'InputLimitExceededError'__.</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- = Motivating Principles</span><span>
</span><span id="line-171"></span><span class="hs-comment">--</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- There are several motivating principles behind the design of the algorithm.</span><span>
</span><span id="line-173"></span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- === Principle 1: Dust Management</span><span>
</span><span id="line-175"></span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- The probability that random selection will choose dust entries from a UTxO</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- set increases with the proportion of dust in the set.</span><span>
</span><span id="line-178"></span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- Therefore, for a UTxO set with a large amount of dust, there's a high</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- probability that a random subset will include a large amount of dust.</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- === Principle 2: Change Management</span><span>
</span><span id="line-183"></span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- Ideally, coin selection algorithms should, over time, create a UTxO set that</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- has /useful/ outputs: outputs that will allow us to process future payments</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- with a minimum number of inputs.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- If for each payment request of value __/v/__ we create a change output of</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- /roughly/ the same value __/v/__, then we will end up with a distribution of</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- change values that matches the typical value distribution of payment</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- requests.</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- === Principle 3: Performance Management</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- Searching the UTxO set for additional entries to improve our change outputs</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- is /only/ useful if the UTxO set contains entries that are sufficiently</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- small enough. But it is precisely when the UTxO set contains many small</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- entries that it is less likely for a randomly-chosen UTxO entry to push the</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- total above the upper bound.</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- @since 1.0.0</span><span>
</span><span id="line-202"></span><span id="local-6989586621679062772"><span id="local-6989586621679062773"><span id="local-6989586621679062774"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#randomImprove"><span class="hs-identifier hs-type">randomImprove</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062772"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062773"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadRandom</span></span><span> </span><span class="annot"><a href="#local-6989586621679062774"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionAlgorithm"><span class="hs-identifier hs-type">CoinSelectionAlgorithm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062772"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062773"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062774"><span class="hs-identifier hs-type">m</span></a></span></span></span></span><span>
</span><span id="line-205"></span><span id="randomImprove"><span class="annot"><span class="annottext">randomImprove :: forall i o (m :: * -&gt; *).
(Ord i, Ord o, MonadRandom m) =&gt;
CoinSelectionAlgorithm i o m
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#randomImprove"><span class="hs-identifier hs-var hs-var">randomImprove</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoinSelectionParameters i o
 -&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o))
-&gt; CoinSelectionAlgorithm i o m
forall i o (m :: * -&gt; *).
(CoinSelectionParameters i o
 -&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o))
-&gt; CoinSelectionAlgorithm i o m
</span><a href="Cardano.CoinSelection.html#CoinSelectionAlgorithm"><span class="hs-identifier hs-var">CoinSelectionAlgorithm</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
-&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o)
forall i o (m :: * -&gt; *).
(Ord i, Ord o, MonadRandom m) =&gt;
CoinSelectionParameters i o
-&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o)
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#payForOutputs"><span class="hs-identifier hs-var">payForOutputs</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span id="local-6989586621679062787"><span id="local-6989586621679062788"><span id="local-6989586621679062789"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#payForOutputs"><span class="hs-identifier hs-type">payForOutputs</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062787"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062788"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadRandom</span></span><span> </span><span class="annot"><a href="#local-6989586621679062789"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionParameters"><span class="hs-identifier hs-type">CoinSelectionParameters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062787"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062788"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionError"><span class="hs-identifier hs-type">CoinSelectionError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062789"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelectionResult"><span class="hs-identifier hs-type">CoinSelectionResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062787"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062788"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-211"></span><span id="payForOutputs"><span class="annot"><span class="annottext">payForOutputs :: forall i o (m :: * -&gt; *).
(Ord i, Ord o, MonadRandom m) =&gt;
CoinSelectionParameters i o
-&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o)
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#payForOutputs"><span class="hs-identifier hs-var hs-var">payForOutputs</span></a></span></span><span> </span><span id="local-6989586621679062984"><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679062985"><span class="annot"><span class="annottext">Maybe (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
</span><a href="#local-6989586621679062985"><span class="hs-identifier hs-var">mRandomSelections</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe
     (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
-&gt; ExceptT
     CoinSelectionError
     m
     (Maybe (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT CoinSelectionError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe
      (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
 -&gt; ExceptT
      CoinSelectionError
      m
      (Maybe (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])))
-&gt; m (Maybe
        (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
-&gt; ExceptT
     CoinSelectionError
     m
     (Maybe (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeT m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; m (Maybe
        (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT
   m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
 -&gt; m (Maybe
         (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])))
-&gt; MaybeT
     m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; m (Maybe
        (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
 -&gt; CoinMapEntry o
 -&gt; MaybeT
      m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)]))
-&gt; (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; [CoinMapEntry o]
-&gt; MaybeT
     m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; CoinMapEntry o
-&gt; MaybeT
     m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
forall i o (m :: * -&gt; *).
MonadRandom m =&gt;
(Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; CoinMapEntry o
-&gt; MaybeT
     m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#makeRandomSelection"><span class="hs-identifier hs-var">makeRandomSelection</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062987"><span class="hs-identifier hs-var">inputCountMax</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinMap i
forall i o. CoinSelectionParameters i o -&gt; CoinMap i
</span><a href="Cardano.CoinSelection.html#inputsAvailable"><span class="hs-identifier hs-var">inputsAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry o]
</span><a href="#local-6989586621679062989"><span class="hs-identifier hs-var">outputsDescending</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
</span><a href="#local-6989586621679062985"><span class="hs-identifier hs-var">mRandomSelections</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679062990"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062990"><span class="hs-identifier hs-var">inputCountRemaining</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679062991"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679062991"><span class="hs-identifier hs-var">utxoRemaining</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679062992"><span class="annot"><span class="annottext">[([CoinMapEntry i], CoinMapEntry o)]
</span><a href="#local-6989586621679062992"><span class="hs-identifier hs-var">randomSelections</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679062993"><span class="annot"><span class="annottext">CoinSelection i o
</span><a href="#local-6989586621679062993"><span class="hs-identifier hs-var">finalSelection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679062994"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679062994"><span class="hs-identifier hs-var">utxoRemaining'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Integer, CoinSelection i o, CoinMap i)
-&gt; ExceptT
     CoinSelectionError m (Integer, CoinSelection i o, CoinMap i)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT CoinSelectionError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Integer, CoinSelection i o, CoinMap i)
 -&gt; ExceptT
      CoinSelectionError m (Integer, CoinSelection i o, CoinMap i))
-&gt; m (Integer, CoinSelection i o, CoinMap i)
-&gt; ExceptT
     CoinSelectionError m (Integer, CoinSelection i o, CoinMap i)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Integer, CoinSelection i o, CoinMap i)
 -&gt; ([CoinMapEntry i], CoinMapEntry o)
 -&gt; m (Integer, CoinSelection i o, CoinMap i))
-&gt; (Integer, CoinSelection i o, CoinMap i)
-&gt; [([CoinMapEntry i], CoinMapEntry o)]
-&gt; m (Integer, CoinSelection i o, CoinMap i)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span>
</span><span id="line-217"></span><span>                </span><span class="annot"><span class="annottext">(Integer, CoinSelection i o, CoinMap i)
-&gt; ([CoinMapEntry i], CoinMapEntry o)
-&gt; m (Integer, CoinSelection i o, CoinMap i)
forall i o (m :: * -&gt; *).
(MonadRandom m, Ord i, Ord o) =&gt;
(Integer, CoinSelection i o, CoinMap i)
-&gt; ([CoinMapEntry i], CoinMapEntry o)
-&gt; m (Integer, CoinSelection i o, CoinMap i)
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#improveSelection"><span class="hs-identifier hs-var">improveSelection</span></a></span><span>
</span><span id="line-218"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062990"><span class="hs-identifier hs-var">inputCountRemaining</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinSelection i o
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679062991"><span class="hs-identifier hs-var">utxoRemaining</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[([CoinMapEntry i], CoinMapEntry o)]
-&gt; [([CoinMapEntry i], CoinMapEntry o)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[([CoinMapEntry i], CoinMapEntry o)]
</span><a href="#local-6989586621679062992"><span class="hs-identifier hs-var">randomSelections</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="annottext">CoinSelectionResult i o
-&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o)
forall a. a -&gt; ExceptT CoinSelectionError m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinSelectionResult i o
 -&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o))
-&gt; CoinSelectionResult i o
-&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelection i o -&gt; CoinMap i -&gt; CoinSelectionResult i o
forall i o.
CoinSelection i o -&gt; CoinMap i -&gt; CoinSelectionResult i o
</span><a href="Cardano.CoinSelection.html#CoinSelectionResult"><span class="hs-identifier hs-var">CoinSelectionResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelection i o
</span><a href="#local-6989586621679062993"><span class="hs-identifier hs-var">finalSelection</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679062994"><span class="hs-identifier hs-var">utxoRemaining'</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>            </span><span class="annot"><span class="annottext">CoinSelectionError
-&gt; ExceptT CoinSelectionError m (CoinSelectionResult i o)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">throwE</span></span><span> </span><span class="annot"><span class="annottext">CoinSelectionError
</span><a href="#local-6989586621679062998"><span class="hs-identifier hs-var">errorCondition</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679062998"><span class="annot"><span class="annottext">errorCondition :: CoinSelectionError
</span><a href="#local-6989586621679062998"><span class="hs-identifier hs-var hs-var">errorCondition</span></a></span></span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679062999"><span class="hs-identifier hs-var">amountAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063001"><span class="hs-identifier hs-var">amountRequested</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>          </span><span class="annot"><span class="annottext">InputValueInsufficientError -&gt; CoinSelectionError
</span><a href="Cardano.CoinSelection.html#InputValueInsufficient"><span class="hs-identifier hs-var">InputValueInsufficient</span></a></span><span> </span><span class="annot"><span class="annottext">(InputValueInsufficientError -&gt; CoinSelectionError)
-&gt; InputValueInsufficientError -&gt; CoinSelectionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-227"></span><span>              </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; InputValueInsufficientError
</span><a href="Cardano.CoinSelection.html#InputValueInsufficientError"><span class="hs-identifier hs-var">InputValueInsufficientError</span></a></span><span>
</span><span id="line-228"></span><span>                  </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679062999"><span class="hs-identifier hs-var">amountAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063001"><span class="hs-identifier hs-var">amountRequested</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679063003"><span class="hs-identifier hs-var">utxoCount</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679063004"><span class="hs-identifier hs-var">outputCount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="annottext">InputCountInsufficientError -&gt; CoinSelectionError
</span><a href="Cardano.CoinSelection.html#InputCountInsufficient"><span class="hs-identifier hs-var">InputCountInsufficient</span></a></span><span> </span><span class="annot"><span class="annottext">(InputCountInsufficientError -&gt; CoinSelectionError)
-&gt; InputCountInsufficientError -&gt; CoinSelectionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-231"></span><span>              </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; InputCountInsufficientError
</span><a href="Cardano.CoinSelection.html#InputCountInsufficientError"><span class="hs-identifier hs-var">InputCountInsufficientError</span></a></span><span>
</span><span id="line-232"></span><span>                  </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679063003"><span class="hs-identifier hs-var">utxoCount</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679063004"><span class="hs-identifier hs-var">outputCount</span></a></span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679063003"><span class="hs-identifier hs-var">utxoCount</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062987"><span class="hs-identifier hs-var">inputCountMax</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="annottext">InputsExhaustedError -&gt; CoinSelectionError
</span><a href="Cardano.CoinSelection.html#InputsExhausted"><span class="hs-identifier hs-var">InputsExhausted</span></a></span><span>
</span><span id="line-235"></span><span>              </span><span class="annot"><span class="annottext">InputsExhaustedError
</span><a href="Cardano.CoinSelection.html#InputsExhaustedError"><span class="hs-identifier hs-var">InputsExhaustedError</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>          </span><span class="annot"><span class="annottext">InputLimitExceededError -&gt; CoinSelectionError
</span><a href="Cardano.CoinSelection.html#InputLimitExceeded"><span class="hs-identifier hs-var">InputLimitExceeded</span></a></span><span> </span><span class="annot"><span class="annottext">(InputLimitExceededError -&gt; CoinSelectionError)
-&gt; InputLimitExceededError -&gt; CoinSelectionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-238"></span><span>              </span><span class="annot"><span class="annottext">Word16 -&gt; InputLimitExceededError
</span><a href="Cardano.CoinSelection.html#InputLimitExceededError"><span class="hs-identifier hs-var">InputLimitExceededError</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; InputLimitExceededError)
-&gt; Word16 -&gt; InputLimitExceededError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-239"></span><span>                  </span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062987"><span class="hs-identifier hs-var">inputCountMax</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621679062999"><span class="annot"><span class="annottext">amountAvailable :: Coin
</span><a href="#local-6989586621679062999"><span class="hs-identifier hs-var hs-var">amountAvailable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">CoinMap i -&gt; Coin
forall a. CoinMap a -&gt; Coin
</span><a href="Cardano.CoinSelection.html#coinMapValue"><span class="hs-identifier hs-var">coinMapValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMap i -&gt; Coin) -&gt; CoinMap i -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinMap i
forall i o. CoinSelectionParameters i o -&gt; CoinMap i
</span><a href="Cardano.CoinSelection.html#inputsAvailable"><span class="hs-identifier hs-var">inputsAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679063001"><span class="annot"><span class="annottext">amountRequested :: Coin
</span><a href="#local-6989586621679063001"><span class="hs-identifier hs-var hs-var">amountRequested</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><span class="annottext">CoinMap o -&gt; Coin
forall a. CoinMap a -&gt; Coin
</span><a href="Cardano.CoinSelection.html#coinMapValue"><span class="hs-identifier hs-var">coinMapValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMap o -&gt; Coin) -&gt; CoinMap o -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinMap o
forall i o. CoinSelectionParameters i o -&gt; CoinMap o
</span><a href="Cardano.CoinSelection.html#outputsRequested"><span class="hs-identifier hs-var">outputsRequested</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679062987"><span class="annot"><span class="annottext">inputCountMax :: Integer
</span><a href="#local-6989586621679062987"><span class="hs-identifier hs-var hs-var">inputCountMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>        </span><span class="annot"><span class="annottext">Word16 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Integer) -&gt; Word16 -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionLimit -&gt; Word16 -&gt; Word16
</span><a href="Cardano.CoinSelection.html#calculateLimit"><span class="hs-identifier hs-var">calculateLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinSelectionLimit
forall i o. CoinSelectionParameters i o -&gt; CoinSelectionLimit
</span><a href="Cardano.CoinSelection.html#limit"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Word16) -&gt; Word16 -&gt; Word16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679063004"><span class="hs-identifier hs-var">outputCount</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621679063004"><span class="annot"><span class="annottext">outputCount :: Natural
</span><a href="#local-6989586621679063004"><span class="hs-identifier hs-var hs-var">outputCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Natural) -&gt; Int -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry o] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([CoinMapEntry o] -&gt; Int) -&gt; [CoinMapEntry o] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMap o -&gt; [CoinMapEntry o]
forall a. CoinMap a -&gt; [CoinMapEntry a]
</span><a href="Cardano.CoinSelection.html#coinMapToList"><span class="hs-identifier hs-var">coinMapToList</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMap o -&gt; [CoinMapEntry o]) -&gt; CoinMap o -&gt; [CoinMapEntry o]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinMap o
forall i o. CoinSelectionParameters i o -&gt; CoinMap o
</span><a href="Cardano.CoinSelection.html#outputsRequested"><span class="hs-identifier hs-var">outputsRequested</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679062989"><span class="annot"><span class="annottext">outputsDescending :: [CoinMapEntry o]
</span><a href="#local-6989586621679062989"><span class="hs-identifier hs-var hs-var">outputsDescending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><span class="annottext">(CoinMapEntry o -&gt; Down Coin)
-&gt; [CoinMapEntry o] -&gt; [CoinMapEntry o]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.OldList.html#sortOn"><span class="hs-identifier hs-var">L.sortOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Down Coin
forall a. a -&gt; Down a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Ord.html#Down"><span class="hs-identifier hs-var">Down</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Down Coin)
-&gt; (CoinMapEntry o -&gt; Coin) -&gt; CoinMapEntry o -&gt; Down Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o -&gt; Coin
forall a. CoinMapEntry a -&gt; Coin
</span><a href="Cardano.CoinSelection.html#entryValue"><span class="hs-identifier hs-var">entryValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CoinMapEntry o] -&gt; [CoinMapEntry o])
-&gt; [CoinMapEntry o] -&gt; [CoinMapEntry o]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMap o -&gt; [CoinMapEntry o]
forall a. CoinMap a -&gt; [CoinMapEntry a]
</span><a href="Cardano.CoinSelection.html#coinMapToList"><span class="hs-identifier hs-var">coinMapToList</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMap o -&gt; [CoinMapEntry o]) -&gt; CoinMap o -&gt; [CoinMapEntry o]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinMap o
forall i o. CoinSelectionParameters i o -&gt; CoinMap o
</span><a href="Cardano.CoinSelection.html#outputsRequested"><span class="hs-identifier hs-var">outputsRequested</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621679063003"><span class="annot"><span class="annottext">utxoCount :: Natural
</span><a href="#local-6989586621679063003"><span class="hs-identifier hs-var hs-var">utxoCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Natural) -&gt; Int -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">([CoinMapEntry i] -&gt; Int) -&gt; [CoinMapEntry i] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMap i -&gt; [CoinMapEntry i]
forall a. CoinMap a -&gt; [CoinMapEntry a]
</span><a href="Cardano.CoinSelection.html#coinMapToList"><span class="hs-identifier hs-var">coinMapToList</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMap i -&gt; [CoinMapEntry i]) -&gt; CoinMap i -&gt; [CoinMapEntry i]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o -&gt; CoinMap i
forall i o. CoinSelectionParameters i o -&gt; CoinMap i
</span><a href="Cardano.CoinSelection.html#inputsAvailable"><span class="hs-identifier hs-var">inputsAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelectionParameters i o
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">-- | Randomly select entries from the given UTxO set, until the total value of</span><span>
</span><span id="line-254"></span><span class="hs-comment">--   selected entries is greater than or equal to the given output value.</span><span>
</span><span id="line-255"></span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- Once a random selection has been made that meets the above criterion, this</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- function returns that selection as is, making no attempt to improve upon</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- the selection in any way.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#makeRandomSelection"><span class="hs-identifier hs-type">makeRandomSelection</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679062825"><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679062826"><span class="annot"><a href="#local-6989586621679062826"><span class="hs-identifier hs-type">o</span></a></span></span><span> </span><span id="local-6989586621679062824"><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadRandom</span></span><span> </span><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062826"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062826"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062826"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span id="makeRandomSelection"><span class="annot"><span class="annottext">makeRandomSelection :: forall i o (m :: * -&gt; *).
MonadRandom m =&gt;
(Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; CoinMapEntry o
-&gt; MaybeT
     m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#makeRandomSelection"><span class="hs-identifier hs-var hs-var">makeRandomSelection</span></a></span></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679063035"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">inputCountRemaining</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063036"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063036"><span class="hs-identifier hs-var">utxoRemaining</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063037"><span class="annot"><span class="annottext">[([CoinMapEntry i], CoinMapEntry o)]
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">existingSelections</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679063038"><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679063039"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063039"><span class="hs-identifier hs-var">utxoSelected</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063040"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063040"><span class="hs-identifier hs-var">utxoRemaining'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([CoinMapEntry i], CoinMap i)
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
</span><a href="#local-6989586621679063041"><span class="hs-identifier hs-var">coverRandomly</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063036"><span class="hs-identifier hs-var">utxoRemaining</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">(Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
-&gt; MaybeT
     m (Integer, CoinMap i, [([CoinMapEntry i], CoinMapEntry o)])
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">inputCountRemaining</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063039"><span class="hs-identifier hs-var">utxoSelected</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063040"><span class="hs-identifier hs-var">utxoRemaining'</span></a></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063039"><span class="hs-identifier hs-var">utxoSelected</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CoinMapEntry i], CoinMapEntry o)
-&gt; [([CoinMapEntry i], CoinMapEntry o)]
-&gt; [([CoinMapEntry i], CoinMapEntry o)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[([CoinMapEntry i], CoinMapEntry o)]
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">existingSelections</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><a href="#local-6989586621679063041"><span class="hs-identifier hs-type">coverRandomly</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>    </span><span id="local-6989586621679063041"><span class="annot"><span class="annottext">coverRandomly :: ([CoinMapEntry i], CoinMap i)
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
</span><a href="#local-6989586621679063041"><span class="hs-identifier hs-var hs-var">coverRandomly</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679063042"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">selected</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063043"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063043"><span class="hs-identifier hs-var">remaining</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">selected</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">inputCountRemaining</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-279"></span><span>            </span><span class="annot"><span class="annottext">m (Maybe ([CoinMapEntry i], CoinMap i))
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe ([CoinMapEntry i], CoinMap i))
 -&gt; MaybeT m ([CoinMapEntry i], CoinMap i))
-&gt; m (Maybe ([CoinMapEntry i], CoinMap i))
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([CoinMapEntry i], CoinMap i)
-&gt; m (Maybe ([CoinMapEntry i], CoinMap i))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([CoinMapEntry i], CoinMap i)
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Coin
forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var">sumEntries</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">selected</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetMin"><span class="hs-identifier hs-var">targetMin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinMapEntry o -&gt; TargetRange
forall o. CoinMapEntry o -&gt; TargetRange
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkTargetRange"><span class="hs-identifier hs-var">mkTargetRange</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>            </span><span class="annot"><span class="annottext">m (Maybe ([CoinMapEntry i], CoinMap i))
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe ([CoinMapEntry i], CoinMap i))
 -&gt; MaybeT m ([CoinMapEntry i], CoinMap i))
-&gt; m (Maybe ([CoinMapEntry i], CoinMap i))
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([CoinMapEntry i], CoinMap i)
-&gt; m (Maybe ([CoinMapEntry i], CoinMap i))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ([CoinMapEntry i], CoinMap i)
 -&gt; m (Maybe ([CoinMapEntry i], CoinMap i)))
-&gt; Maybe ([CoinMapEntry i], CoinMap i)
-&gt; m (Maybe ([CoinMapEntry i], CoinMap i))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([CoinMapEntry i], CoinMap i)
-&gt; Maybe ([CoinMapEntry i], CoinMap i)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">selected</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063043"><span class="hs-identifier hs-var">remaining</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">m (Maybe (CoinMapEntry i, CoinMap i))
-&gt; MaybeT m (CoinMapEntry i, CoinMap i)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinMap i -&gt; m (Maybe (CoinMapEntry i, CoinMap i))
forall (m :: * -&gt; *) a.
MonadRandom m =&gt;
CoinMap a -&gt; m (Maybe (CoinMapEntry a, CoinMap a))
</span><a href="Cardano.CoinSelection.html#coinMapRandomEntry"><span class="hs-identifier hs-var">coinMapRandomEntry</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063043"><span class="hs-identifier hs-var">remaining</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeT m (CoinMapEntry i, CoinMap i)
-&gt; ((CoinMapEntry i, CoinMap i)
    -&gt; MaybeT m ([CoinMapEntry i], CoinMap i))
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
forall a b. MaybeT m a -&gt; (a -&gt; MaybeT m b) -&gt; MaybeT m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679063049"><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063049"><span class="hs-identifier hs-var">picked</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063050"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063050"><span class="hs-identifier hs-var">remaining'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>                </span><span class="annot"><span class="annottext">([CoinMapEntry i], CoinMap i)
-&gt; MaybeT m ([CoinMapEntry i], CoinMap i)
</span><a href="#local-6989586621679063041"><span class="hs-identifier hs-var">coverRandomly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063049"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i -&gt; [CoinMapEntry i] -&gt; [CoinMapEntry i]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">selected</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063050"><span class="hs-identifier hs-var">remaining'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><span class="hs-comment">-- | Perform an improvement to random selection on a given output.</span></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#improveSelection"><span class="hs-identifier hs-type">improveSelection</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679062831"><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679062832"><span class="annot"><a href="#local-6989586621679062832"><span class="hs-identifier hs-type">o</span></a></span></span><span> </span><span id="local-6989586621679062830"><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadRandom</span></span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062832"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelection"><span class="hs-identifier hs-type">CoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062832"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062832"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelection"><span class="hs-identifier hs-type">CoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062832"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span id="improveSelection"><span class="annot"><span class="annottext">improveSelection :: forall i o (m :: * -&gt; *).
(MonadRandom m, Ord i, Ord o) =&gt;
(Integer, CoinSelection i o, CoinMap i)
-&gt; ([CoinMapEntry i], CoinMapEntry o)
-&gt; m (Integer, CoinSelection i o, CoinMap i)
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#improveSelection"><span class="hs-identifier hs-var hs-var">improveSelection</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679063074"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063074"><span class="hs-identifier hs-var">maxN0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063075"><span class="annot"><span class="annottext">CoinSelection i o
</span><a href="#local-6989586621679063075"><span class="hs-identifier hs-var">selection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063076"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063076"><span class="hs-identifier hs-var">utxo0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679063077"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063077"><span class="hs-identifier hs-var">inps0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063078"><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063078"><span class="hs-identifier hs-var">txout</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679063079"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063079"><span class="hs-identifier hs-var">maxN</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063080"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063080"><span class="hs-identifier hs-var">inps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063081"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063081"><span class="hs-identifier hs-var">utxo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Integer, [CoinMapEntry i], CoinMap i)
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
</span><a href="#local-6989586621679063082"><span class="hs-identifier hs-var">improve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063074"><span class="hs-identifier hs-var">maxN0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063077"><span class="hs-identifier hs-var">inps0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063076"><span class="hs-identifier hs-var">utxo0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">(Integer, CoinSelection i o, CoinMap i)
-&gt; m (Integer, CoinSelection i o, CoinMap i)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063079"><span class="hs-identifier hs-var">maxN</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinSelection i o
</span><a href="#local-6989586621679063075"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">CoinSelection i o -&gt; CoinSelection i o -&gt; CoinSelection i o
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinSelection"><span class="hs-identifier hs-type">CoinSelection</span></a></span><span>
</span><span id="line-297"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inputs :: CoinMap i
</span><a href="Cardano.CoinSelection.html#inputs"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; CoinMap i
forall a. Ord a =&gt; [CoinMapEntry a] -&gt; CoinMap a
</span><a href="Cardano.CoinSelection.html#coinMapFromList"><span class="hs-identifier hs-var">coinMapFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063080"><span class="hs-identifier hs-var">inps</span></a></span><span>
</span><span id="line-298"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">outputs :: CoinMap o
</span><a href="Cardano.CoinSelection.html#outputs"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry o] -&gt; CoinMap o
forall a. Ord a =&gt; [CoinMapEntry a] -&gt; CoinMap a
</span><a href="Cardano.CoinSelection.html#coinMapFromList"><span class="hs-identifier hs-var">coinMapFromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063078"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">change :: [Coin]
</span><a href="Cardano.CoinSelection.html#change"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o -&gt; [CoinMapEntry i] -&gt; [Coin]
forall o i. CoinMapEntry o -&gt; [CoinMapEntry i] -&gt; [Coin]
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkChange"><span class="hs-identifier hs-var">mkChange</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063078"><span class="hs-identifier hs-var">txout</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063080"><span class="hs-identifier hs-var">inps</span></a></span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063081"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679063085"><span class="annot"><span class="annottext">target :: TargetRange
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o -&gt; TargetRange
forall o. CoinMapEntry o -&gt; TargetRange
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkTargetRange"><span class="hs-identifier hs-var">mkTargetRange</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry o
</span><a href="#local-6989586621679063078"><span class="hs-identifier hs-var">txout</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="#local-6989586621679063082"><span class="hs-identifier hs-type">improve</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMap"><span class="hs-identifier hs-type">CoinMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621679063082"><span class="annot"><span class="annottext">improve :: (Integer, [CoinMapEntry i], CoinMap i)
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
</span><a href="#local-6989586621679063082"><span class="hs-identifier hs-var hs-var">improve</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679063086"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063086"><span class="hs-identifier hs-var">maxN</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063087"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063088"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063088"><span class="hs-identifier hs-var">utxo</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063086"><span class="hs-identifier hs-var">maxN</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Coin
forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var">sumEntries</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetAim"><span class="hs-identifier hs-var">targetAim</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><span class="annottext">CoinMap i -&gt; m (Maybe (CoinMapEntry i, CoinMap i))
forall (m :: * -&gt; *) a.
MonadRandom m =&gt;
CoinMap a -&gt; m (Maybe (CoinMapEntry a, CoinMap a))
</span><a href="Cardano.CoinSelection.html#coinMapRandomEntry"><span class="hs-identifier hs-var">coinMapRandomEntry</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063088"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe (CoinMapEntry i, CoinMap i))
-&gt; (Maybe (CoinMapEntry i, CoinMap i)
    -&gt; m (Integer, [CoinMapEntry i], CoinMap i))
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-312"></span><span>                </span><span class="annot"><span class="annottext">Maybe (CoinMapEntry i, CoinMap i)
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>                    </span><span class="annot"><span class="annottext">(Integer, [CoinMapEntry i], CoinMap i)
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063086"><span class="hs-identifier hs-var">maxN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063088"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679063091"><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063091"><span class="hs-identifier hs-var">io</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679063092"><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063092"><span class="hs-identifier hs-var">utxo'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i -&gt; [CoinMapEntry i] -&gt; Bool
</span><a href="#local-6989586621679063093"><span class="hs-identifier hs-var">isImprovement</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063091"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679063094"><span class="annot"><span class="annottext">inps' :: [CoinMapEntry i]
</span><a href="#local-6989586621679063094"><span class="hs-identifier hs-var hs-var">inps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063091"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i -&gt; [CoinMapEntry i] -&gt; [CoinMapEntry i]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span><span>
</span><span id="line-316"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679063095"><span class="annot"><span class="annottext">maxN' :: Integer
</span><a href="#local-6989586621679063095"><span class="hs-identifier hs-var hs-var">maxN'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063086"><span class="hs-identifier hs-var">maxN</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-317"></span><span>                    </span><span class="annot"><span class="annottext">(Integer, [CoinMapEntry i], CoinMap i)
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
</span><a href="#local-6989586621679063082"><span class="hs-identifier hs-var">improve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063095"><span class="hs-identifier hs-var">maxN'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063094"><span class="hs-identifier hs-var">inps'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063092"><span class="hs-identifier hs-var">utxo'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMapEntry i, CoinMap i)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>                    </span><span class="annot"><span class="annottext">(Integer, [CoinMapEntry i], CoinMap i)
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063086"><span class="hs-identifier hs-var">maxN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063088"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-321"></span><span>            </span><span class="annot"><span class="annottext">(Integer, [CoinMapEntry i], CoinMap i)
-&gt; m (Integer, [CoinMapEntry i], CoinMap i)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679063086"><span class="hs-identifier hs-var">maxN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063087"><span class="hs-identifier hs-var">inps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoinMap i
</span><a href="#local-6989586621679063088"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><a href="#local-6989586621679063093"><span class="hs-identifier hs-type">isImprovement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679063093"><span class="annot"><span class="annottext">isImprovement :: CoinMapEntry i -&gt; [CoinMapEntry i] -&gt; Bool
</span><a href="#local-6989586621679063093"><span class="hs-identifier hs-var hs-var">isImprovement</span></a></span></span><span> </span><span id="local-6989586621679063096"><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063096"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span id="local-6989586621679063097"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063097"><span class="hs-identifier hs-var">selected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-326"></span><span>            </span><span id="local-6989586621679063098"><span class="annot"><span class="annottext">condA :: Bool
</span><a href="#local-6989586621679063098"><span class="hs-identifier hs-var hs-var">condA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- (a) It doesn&#8217;t exceed a specified upper limit.</span><span>
</span><span id="line-327"></span><span>                </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Coin
forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var">sumEntries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063096"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i -&gt; [CoinMapEntry i] -&gt; [CoinMapEntry i]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063097"><span class="hs-identifier hs-var">selected</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetMax"><span class="hs-identifier hs-var">targetMax</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>            </span><span id="local-6989586621679063100"><span class="annot"><span class="annottext">condB :: Bool
</span><a href="#local-6989586621679063100"><span class="hs-identifier hs-var hs-var">condB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- (b) Addition gets us closer to the ideal change</span><span>
</span><span id="line-330"></span><span>                </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063101"><span class="hs-identifier hs-var">distanceA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063102"><span class="hs-identifier hs-var">distanceB</span></a></span><span>
</span><span id="line-331"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-332"></span><span>                </span><span id="local-6989586621679063101"><span class="annot"><span class="annottext">distanceA :: Coin
</span><a href="#local-6989586621679063101"><span class="hs-identifier hs-var hs-var">distanceA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Internal.Coin.html#distance"><span class="hs-identifier hs-var">C.distance</span></a></span><span>
</span><span id="line-333"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetAim"><span class="hs-identifier hs-var">targetAim</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Coin
forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var">sumEntries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinMapEntry i
</span><a href="#local-6989586621679063096"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i -&gt; [CoinMapEntry i] -&gt; [CoinMapEntry i]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063097"><span class="hs-identifier hs-var">selected</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>                </span><span id="local-6989586621679063102"><span class="annot"><span class="annottext">distanceB :: Coin
</span><a href="#local-6989586621679063102"><span class="hs-identifier hs-var hs-var">distanceB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Internal.Coin.html#distance"><span class="hs-identifier hs-var">C.distance</span></a></span><span>
</span><span id="line-336"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetAim"><span class="hs-identifier hs-var">targetAim</span></a></span><span> </span><span class="annot"><span class="annottext">TargetRange
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Coin
forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var">sumEntries</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063097"><span class="hs-identifier hs-var">selected</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>            </span><span class="hs-comment">-- (c) Doesn't exceed maximum number of inputs</span><span>
</span><span id="line-340"></span><span>            </span><span class="hs-comment">-- Guaranteed by the precondition on 'improve'.</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-342"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679063098"><span class="hs-identifier hs-var">condA</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679063100"><span class="hs-identifier hs-var">condB</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- Internals</span><span>
</span><span id="line-346"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- | Represents a target range of /total input values/ for a given output.</span><span>
</span><span id="line-349"></span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- In this context, /total input value/ refers to the total value of a set of</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- inputs selected to pay for a given output.</span><span>
</span><span id="line-352"></span><span class="hs-comment">--</span><span>
</span><span id="line-353"></span><span class="hs-keyword">data</span><span> </span><span id="TargetRange"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#TargetRange"><span class="hs-identifier hs-var">TargetRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TargetRange"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#TargetRange"><span class="hs-identifier hs-var">TargetRange</span></a></span></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="targetMin"><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetMin"><span class="hs-identifier hs-var hs-var">targetMin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Internal.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-comment">-- ^ The minimum value, corresponding to exactly the requested target</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-comment">-- amount, and a change amount of zero.</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="targetAim"><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetAim"><span class="hs-identifier hs-var hs-var">targetAim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Internal.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-comment">-- ^ The ideal value, corresponding to exactly twice the requested</span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-comment">-- target amount, and a change amount equal to the requested amount.</span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="targetMax"><span class="annot"><span class="annottext">TargetRange -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetMax"><span class="hs-identifier hs-var hs-var">targetMax</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Internal.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-comment">-- ^ The maximum value, corresponding to exactly three times the</span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-comment">-- requested amount, and a change amount equal to twice the requested</span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-comment">-- amount.</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- | Compute the target range of /total input values/ for a given output.</span><span>
</span><span id="line-367"></span><span class="hs-comment">--</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- See 'TargetRange'.</span><span>
</span><span id="line-369"></span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span id="local-6989586621679062873"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkTargetRange"><span class="hs-identifier hs-type">mkTargetRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062873"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#TargetRange"><span class="hs-identifier hs-type">TargetRange</span></a></span></span><span>
</span><span id="line-371"></span><span id="mkTargetRange"><span class="annot"><span class="annottext">mkTargetRange :: forall o. CoinMapEntry o -&gt; TargetRange
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkTargetRange"><span class="hs-identifier hs-var hs-var">mkTargetRange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679063106"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#TargetRange"><span class="hs-identifier hs-type">TargetRange</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">targetMin :: Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetMin"><span class="hs-identifier hs-var">targetMin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">targetAim :: Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetAim"><span class="hs-identifier hs-var">targetAim</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Internal.Coin.html#add"><span class="hs-operator hs-var">`C.add`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">targetMax :: Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#targetMax"><span class="hs-identifier hs-var">targetMax</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Internal.Coin.html#add"><span class="hs-operator hs-var">`C.add`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Internal.Coin.html#add"><span class="hs-operator hs-var">`C.add`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-comment">-- | Compute change outputs from a target output and a selection of inputs.</span><span>
</span><span id="line-378"></span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- Pre-condition:</span><span>
</span><span id="line-380"></span><span class="hs-comment">--</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- The output must be less than (or equal to) the sum of the inputs.</span><span>
</span><span id="line-382"></span><span class="hs-comment">--</span><span>
</span><span id="line-383"></span><span id="local-6989586621679062885"><span id="local-6989586621679062886"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkChange"><span class="hs-identifier hs-type">mkChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062885"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062886"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Internal.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-384"></span><span id="mkChange"><span class="annot"><span class="annottext">mkChange :: forall o i. CoinMapEntry o -&gt; [CoinMapEntry i] -&gt; [Coin]
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#mkChange"><span class="hs-identifier hs-var hs-var">mkChange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679063112"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063112"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679063113"><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063113"><span class="hs-identifier hs-var">inps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621679063114"><span class="hs-identifier hs-var">difference</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; [Coin]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Coin]) -&gt; [Char] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-388"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;mkChange: &quot;</span></span><span>
</span><span id="line-389"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;output must be less than or equal to sum of inputs&quot;</span></span><span>
</span><span id="line-390"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679063116"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063116"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Bool
</span><a href="Internal.Coin.html#isZero"><span class="hs-identifier hs-var">C.isZero</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063116"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679063118"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063118"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063118"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679063114"><span class="annot"><span class="annottext">difference :: Maybe Coin
</span><a href="#local-6989586621679063114"><span class="hs-identifier hs-var hs-var">difference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i] -&gt; Coin
forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var">sumEntries</span></a></span><span> </span><span class="annot"><span class="annottext">[CoinMapEntry i]
</span><a href="#local-6989586621679063113"><span class="hs-identifier hs-var">inps</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Maybe Coin
</span><a href="Internal.Coin.html#sub"><span class="hs-operator hs-var">`C.sub`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679063112"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- Utilities</span><span>
</span><span id="line-400"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span id="local-6989586621679062871"><span class="annot"><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-type">sumEntries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CoinSelection.html#CoinMapEntry"><span class="hs-identifier hs-type">CoinMapEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062871"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Internal.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-403"></span><span id="sumEntries"><span class="annot"><span class="annottext">sumEntries :: forall i. [CoinMapEntry i] -&gt; Coin
</span><a href="Cardano.CoinSelection.Algorithm.RandomImprove.html#sumEntries"><span class="hs-identifier hs-var hs-var">sumEntries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; Coin)
-&gt; ([CoinMapEntry i] -&gt; [Coin]) -&gt; [CoinMapEntry i] -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinMapEntry i -&gt; Coin) -&gt; [CoinMapEntry i] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">CoinMapEntry i -&gt; Coin
forall a. CoinMapEntry a -&gt; Coin
</span><a href="Cardano.CoinSelection.html#entryValue"><span class="hs-identifier hs-var">entryValue</span></a></span><span>
</span><span id="line-404"></span></pre></body></html>